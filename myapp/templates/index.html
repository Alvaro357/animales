{% load static tailwind_tags %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Adopta - Encuentra tu compañero perfecto</title>  
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style type="text/tailwindcss">
        html {
            font-size: 16px;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            text-align: center;
            padding-top: 100px;
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* Fondo de estrellas interactivas */
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #ffffff;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 3s infinite;
        }
        
        .star.large {
            width: 3px;
            height: 3px;
            animation: twinkle 4s infinite;
        }
        
        .star.bright {
            background: #60a5fa;
            box-shadow: 0 0 4px #60a5fa;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        /* Efecto de movimiento de estrellas */
        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: linear-gradient(45deg, #60a5fa, transparent);
            border-radius: 50%;
            opacity: 0;
            animation: shoot 2s linear infinite;
        }
        
        @keyframes shoot {
            0% {
                opacity: 1;
                transform: translateX(-100px) translateY(100px);
            }
            100% {
                opacity: 0;
                transform: translateX(100px) translateY(-100px);
            }
        }
        
        /* Contenedor principal con z-index alto */
        .content-wrapper {
            position: relative;
            z-index: 10;
        }
        
        /* Navbar glassmorphism */
        .navbar-glass {
            backdrop-filter: blur(20px);
            background: rgba(10, 10, 10, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Botones con efectos modernos */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        /* Cards modernas */
        .animal-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .animal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }
        
        .animal-card:hover::before {
            opacity: 1;
        }
        
        .animal-card:hover {
            transform: translateY(-8px);
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 
                        0 0 0 1px rgba(59, 130, 246, 0.1);
        }
        
        .card-content {
            position: relative;
            z-index: 1;
        }
        
        /* Botón de favorito */
        .favorite-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 20;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .favorite-btn:hover {
            background: rgba(0, 0, 0, 0.5);
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .favorite-btn.active {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
        }
        
        .favorite-btn.active:hover {
            background: rgba(239, 68, 68, 0.3);
        }
        
        .heart-icon {
            width: 1.25rem;
            height: 1.25rem;
            transition: all 0.3s ease;
        }
        
        .heart-outline {
            stroke: #ffffff;
            stroke-width: 2;
            fill: none;
        }
        
        .favorite-btn:hover .heart-outline {
            stroke: #ef4444;
        }
        
        .heart-filled {
            fill: #ef4444;
            stroke: #ef4444;
            stroke-width: 1;
        }
        
        /* Animación de corazón */
        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .favorite-btn.animate-heart {
            animation: heartBeat 0.6s ease-in-out;
        }
        
        /* Filtros */
        .filter-container {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .filter-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 44px;
            font-size: 16px;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-color: #3b82f6;
            color: #ffffff;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
        
        .filter-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        /* Responsive para filtros */
        @media (max-width: 768px) {
            .filter-btn {
                padding: 24px 32px;
                font-size: 20px;
                min-width: 140px;
                min-height: 60px;
                font-weight: 600;
                border-width: 2px;
            }
            
            .filter-container {
                padding: 12px;
                margin: 0 -0.5rem;
            }
            
            .filter-container .flex {
                gap: 16px;
                flex-wrap: wrap;
            }
            
            .search-input {
                padding: 20px 24px;
                font-size: 18px;
                min-height: 60px;
            }
            
            .btn-primary, .btn-secondary {
                padding: 16px 24px;
                font-size: 18px;
                min-height: 54px;
            }
        }
        
        /* Buscador */
        .search-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #ffffff;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Título principal */
        .main-title {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.025em;
            background: linear-gradient(135deg, #ffffff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
            }
            
            body {
                padding-top: 80px;
            }
            
            .filter-container {
                margin: 0 -1rem;
                border-radius: 1rem;
            }
            
            .animal-card {
                margin-bottom: 1rem;
            }
        }
        
        /* Contador de resultados */
        .results-counter {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .results-counter.no-results {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        /* Placeholders de carga */
        .loading-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: pulse 2s ease-in-out infinite alternate;
        }
        
        @keyframes pulse {
            0% { opacity: 0.4; }
            100% { opacity: 0.8; }
        }
        
        .loading-shimmer {
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.05) 25%, 
                rgba(255, 255, 255, 0.1) 50%, 
                rgba(255, 255, 255, 0.05) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Modal moderno */
        .modal-backdrop {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.8);
        }
        
        .modal-content {
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Formularios */
        .form-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-label {
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* Estilos para select en modo oscuro */
        select.form-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ffffff;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        select.form-input option {
            background-color: #1f2937;
            color: #ffffff;
            padding: 8px 12px;
        }

        select.form-input option:checked,
        select.form-input option:hover {
            background-color: #3b82f6;
            color: #ffffff;
        }

        select.form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Efectos de entrada */
        .fade-in {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Ocultar scrollbar horizontal */
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Spinners para crear animal */
        .create-spinner {
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-left: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        .create-spinner-small {
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-left: 2px solid #3b82f6;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        /* Estilos específicos para textarea */
        textarea.form-input {
            resize: vertical;
            min-height: 120px;
        }
        
        /* Indicadores de archivo */
        .file-indicator {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            color: #22c55e;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
        }
        
        /* Spinners de loading */
        .register-spinner {
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-left: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        .register-spinner-small {
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-left: 2px solid #3b82f6;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        /* Transiciones suaves entre formularios */
        .form-transition {
            transition: all 0.3s ease-in-out;
        }
        
        .form-fade-out {
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .form-fade-in {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Contador de favoritos */
        .favorites-counter {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #ef4444;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 4px;
        }
    </style>
</head>
<body>

<!-- Fondo de estrellas -->
<div id="starfield"></div>

<!-- Wrapper de contenido -->
<div class="content-wrapper">

    <!-- Modal de Login/Registro -->
    <div id="authModal" class="fixed inset-0 flex items-center justify-center z-50 modal-backdrop hidden">
        <div id="modalContent" class="modal-content p-8 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-500">
            <button onclick="cerrarModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl z-10">&times;</button>
            
            <!-- Formulario de Login -->
            <div id="loginForm">
                <h2 class="text-2xl font-semibold mb-6 text-center text-white">Iniciar sesión</h2>
                <form method="post" action="/login/">
                    {% csrf_token %}
                    {% if form.non_field_errors %}
                        <div class="mb-4 text-red-400 text-sm">
                            {{ form.non_field_errors }}
                        </div>
                    {% endif %}
                    <div class="mb-4">
                        <label for="username" class="block text-sm font-medium form-label mb-2">Usuario</label>
                        <input type="text" id="username" name="username" 
                               class="form-input w-full px-4 py-3 rounded-lg transition-all duration-300" required>
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-sm font-medium form-label mb-2">Contraseña</label>
                        <input type="password" id="password" name="password" 
                               class="form-input w-full px-4 py-3 rounded-lg transition-all duration-300" required>
                    </div>
                    <button type="submit" class="btn-primary w-full px-6 py-3 rounded-lg font-medium text-white">
                        Iniciar sesión
                    </button>
                </form>
                
                <div class="mt-6 pt-6 border-t border-gray-700 text-center">
                    <p class="text-gray-400 text-sm mb-3">¿No tienes cuenta?</p>
                    <button onclick="mostrarRegistro()" class="btn-secondary inline-block px-6 py-2 rounded-lg text-sm font-medium text-white">
                        Regístrate
                    </button>
                </div>
            </div>

            <!-- Formulario de Registro -->
            <div id="registerForm" class="hidden">
                <h2 class="text-2xl font-semibold mb-6 text-center text-white">Registrar Asociación</h2>
                
                <!-- Overlay de loading para registro -->
                <div id="registerLoadingOverlay" class="absolute inset-0 flex items-center justify-center hidden bg-black/80 backdrop-blur-sm rounded-2xl">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col items-center border border-gray-600">
                        <div class="register-spinner mb-3"></div>
                        <p class="text-white font-medium">Registrando asociación...</p>
                        <p class="text-sm text-gray-400 mt-1">Por favor, no cierres esta ventana</p>
                    </div>
                </div>

                <form method="post" action="/registro/" enctype="multipart/form-data" id="registerFormElement">
                    {% csrf_token %}
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="reg_nombre" class="block text-sm font-medium form-label mb-2">
                                Nombre <span class="text-red-400">*</span>
                            </label>
                            <input type="text" id="reg_nombre" name="nombre" 
                                   class="form-input w-full px-4 py-3 rounded-lg" required>
                        </div>
                        
                        <div>
                            <label for="reg_password" class="block text-sm font-medium form-label mb-2">
                                Contraseña <span class="text-red-400">*</span>
                            </label>
                            <input type="password" id="reg_password" name="password" 
                                   class="form-input w-full px-4 py-3 rounded-lg" required>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="reg_email" class="block text-sm font-medium form-label mb-2">
                            Email <span class="text-red-400">*</span>
                        </label>
                        <input type="email" id="reg_email" name="email" 
                               class="form-input w-full px-4 py-3 rounded-lg" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="reg_telefono" class="block text-sm font-medium form-label mb-2">
                                Teléfono <span class="text-red-400">*</span>
                            </label>
                            <input type="tel" id="reg_telefono" name="telefono" 
                                   class="form-input w-full px-4 py-3 rounded-lg" required>
                        </div>
                        
                        <div>
                            <label for="reg_logo" class="block text-sm font-medium form-label mb-2">
                                Logo (opcional)
                            </label>
                            <input type="file" id="reg_logo" name="logo" accept="image/*"
                                   class="form-input w-full px-4 py-3 rounded-lg text-sm">
                            <div id="logoStatus" class="mt-1 text-sm text-gray-400 hidden"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="reg_direccion" class="block text-sm font-medium form-label mb-2">
                            Dirección <span class="text-red-400">*</span>
                        </label>
                        <input type="text" id="reg_direccion" name="direccion" 
                               class="form-input w-full px-4 py-3 rounded-lg" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label for="reg_poblacion" class="block text-sm font-medium form-label mb-2">
                                Población <span class="text-red-400">*</span>
                            </label>
                            <input type="text" id="reg_poblacion" name="poblacion" 
                                   class="form-input w-full px-4 py-3 rounded-lg" required>
                        </div>
                        
                        <div>
                            <label for="reg_provincia" class="block text-sm font-medium form-label mb-2">
                                Provincia <span class="text-red-400">*</span>
                            </label>
                            <input type="text" id="reg_provincia" name="provincia" 
                                   class="form-input w-full px-4 py-3 rounded-lg" required>
                        </div>
                        
                        <div>
                            <label for="reg_codigo_postal" class="block text-sm font-medium form-label mb-2">
                                Código Postal <span class="text-red-400">*</span>
                            </label>
                            <input type="text" id="reg_codigo_postal" name="codigo_postal" 
                                   class="form-input w-full px-4 py-3 rounded-lg" required>
                        </div>
                    </div>

                    <button type="submit" id="registerSubmitBtn" class="btn-primary w-full px-6 py-3 rounded-lg font-medium text-white mb-6">
                        <span class="button-text">Registrar Asociación</span>
                        <span class="button-loading hidden">
                            <div class="register-spinner-small mr-2"></div>
                            <span class="loading-dots">Procesando</span>
                        </span>
                    </button>
                </form>
                
                <div class="pt-6 border-t border-gray-700 text-center">
                    <p class="text-gray-400 text-sm mb-3">¿Ya tienes cuenta?</p>
                    <button onclick="mostrarLogin()" class="btn-secondary inline-block px-6 py-2 rounded-lg text-sm font-medium text-white">
                        Iniciar sesión
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Crear Animal -->
    <div id="crearAnimalModal" class="fixed inset-0 flex items-center justify-center z-50 modal-backdrop hidden">
        <div id="crearAnimalContent" class="modal-content p-8 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-500">
            <button onclick="cerrarCrearAnimal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl z-10">&times;</button>
            
            <div id="crearAnimalForm">
                <h2 class="text-3xl font-semibold mb-8 text-center text-white">Registrar Nuevo Animal</h2>
                
                <!-- Overlay de loading -->
                <div id="crearAnimalLoadingOverlay" class="absolute inset-0 flex items-center justify-center hidden bg-black/80 backdrop-blur-sm rounded-2xl">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col items-center border border-gray-600">
                        <div class="create-spinner mb-3"></div>
                        <p class="text-white font-medium">Creando animal...</p>
                        <p class="text-sm text-gray-400 mt-1">Por favor, no cierres esta ventana</p>
                    </div>
                </div>

                <form method="post" action="/crear_animal/" enctype="multipart/form-data" id="crearAnimalFormElement">
                    {% csrf_token %}
                    
                    <!-- Información básica -->
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4 border-b border-gray-600 pb-2">Información Básica</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="animal_nombre" class="block text-sm font-medium form-label mb-2">
                                    Nombre <span class="text-red-400">*</span>
                                </label>
                                <input type="text" id="animal_nombre" name="nombre" 
                                       class="form-input w-full px-4 py-3 rounded-lg" required 
                                       placeholder="Nombre del animal">
                            </div>
                            
                            <div>
                                <label for="animal_tipo" class="block text-sm font-medium form-label mb-2">
                                    Tipo de Animal <span class="text-red-400">*</span>
                                </label>
                                <select id="animal_tipo" name="tipo_de_animal" 
                                        class="form-input w-full px-4 py-3 rounded-lg" required>
                                    <option value="" class="bg-gray-800">Seleccionar tipo</option>
                                    <option value="Perro" class="bg-gray-800">Perro</option>
                                    <option value="Gato" class="bg-gray-800">Gato</option>
                                    <option value="Conejo" class="bg-gray-800">Conejo</option>
                                    <option value="Pájaro" class="bg-gray-800">Pájaro</option>
                                    <option value="Otros" class="bg-gray-800">Otros</option>
                                </select>
                            </div>
                            
                            <!-- CAMPO COLOR COMBINADO -->
                            <div>
                                <label for="animal_color_select" class="block text-sm font-medium form-label mb-2">
                                    Color <span class="text-red-400">*</span>
                                </label>
                                <div class="space-y-3">
                                    <!-- Selector de colores predefinidos -->
                                    <select id="animal_color_select" name="color_predefinido" 
                                            class="form-input w-full px-4 py-3 rounded-lg" 
                                            onchange="manejarCambioColor()">
                                        <option value="" class="bg-gray-800">Seleccionar color</option>
                                        <option value="Negro" class="bg-gray-800">Negro</option>
                                        <option value="Blanco" class="bg-gray-800">Blanco</option>
                                        <option value="Marrón" class="bg-gray-800">Marrón</option>
                                        <option value="Gris" class="bg-gray-800">Gris</option>
                                        <option value="Dorado" class="bg-gray-800">Dorado</option>
                                        <option value="Rubio" class="bg-gray-800">Rubio</option>
                                        <option value="Rojizo" class="bg-gray-800">Rojizo</option>
                                        <option value="Atigrado" class="bg-gray-800">Atigrado</option>
                                        <option value="Manchado" class="bg-gray-800">Manchado</option>
                                        <option value="Tricolor" class="bg-gray-800">Tricolor</option>
                                        <option value="Bicolor" class="bg-gray-800">Bicolor</option>
                                        <option value="Otro" class="bg-gray-800">Otro (especificar)</option>
                                    </select>
                                    
                                    <!-- Campo de texto personalizado (oculto inicialmente) -->
                                    <input type="text" id="animal_color_custom" name="color_personalizado" 
                                           class="form-input w-full px-4 py-3 rounded-lg hidden" 
                                           placeholder="Especifica el color del animal...">
                                    
                                    <!-- Campo oculto que enviará el valor final -->
                                    <input type="hidden" id="animal_color_final" name="color" value="">
                                </div>
                            </div>
                            
                            <div>
                                <label for="animal_raza" class="block text-sm font-medium form-label mb-2">
                                    Raza <span class="text-red-400">*</span>
                                </label>
                                <input type="text" id="animal_raza" name="raza" 
                                       class="form-input w-full px-4 py-3 rounded-lg" required 
                                       placeholder="Raza del animal">
                            </div>
                        </div>
                    </div>

                    <!-- Multimedia -->
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4 border-b border-gray-600 pb-2">Multimedia</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium form-label mb-2">Imagen</label>
                                <div class="relative">
                                    <input type="file" id="animal_imagen" name="imagen" accept="image/*" class="hidden">
                                    <button type="button" onclick="document.getElementById('animal_imagen').click()" 
                                            class="file-upload-btn w-full px-6 py-4 rounded-xl border-2 border-dashed border-gray-600 hover:border-blue-400 transition-all duration-300 group">
                                        <div class="flex flex-col items-center gap-3">
                                            <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center group-hover:bg-blue-500/30 transition-colors">
                                                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                                </svg>
                                            </div>
                                            <div class="text-center">
                                                <p class="text-white font-medium">Subir Imagen</p>
                                                <p class="text-gray-400 text-sm">Haz clic para seleccionar</p>
                                            </div>
                                        </div>
                                    </button>
                                    <div id="imagenStatus" class="mt-2 hidden"></div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium form-label mb-2">Video</label>
                                <div class="relative">
                                    <input type="file" id="animal_video" name="video" accept="video/*" class="hidden">
                                    <button type="button" onclick="document.getElementById('animal_video').click()" 
                                            class="file-upload-btn w-full px-6 py-4 rounded-xl border-2 border-dashed border-gray-600 hover:border-purple-400 transition-all duration-300 group">
                                        <div class="flex flex-col items-center gap-3">
                                            <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center group-hover:bg-purple-500/30 transition-colors">
                                                <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                                </svg>
                                            </div>
                                            <div class="text-center">
                                                <p class="text-white font-medium">Subir Video</p>
                                                <p class="text-gray-400 text-sm">Haz clic para seleccionar</p>
                                            </div>
                                        </div>
                                    </button>
                                    <div id="videoStatus" class="mt-2 hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contacto -->
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4 border-b border-gray-600 pb-2">Información de Contacto</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="animal_email" class="block text-sm font-medium form-label mb-2">
                                    Email <span class="text-red-400">*</span>
                                </label>
                                <input type="email" id="animal_email" name="email" 
                                       class="form-input w-full px-4 py-3 rounded-lg" required 
                                       placeholder="email@ejemplo.com">
                            </div>
                            
                            <div>
                                <label for="animal_telefono" class="block text-sm font-medium form-label mb-2">
                                    Teléfono <span class="text-red-400">*</span>
                                </label>
                                <input type="tel" id="animal_telefono" name="telefono" 
                                       class="form-input w-full px-4 py-3 rounded-lg" required 
                                       placeholder="123456789">
                            </div>
                        </div>
                    </div>

                    <!-- Ubicación -->
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4 border-b border-gray-600 pb-2">Ubicación</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="animal_poblacion" class="block text-sm font-medium form-label mb-2">
                                    Población <span class="text-red-400">*</span>
                                </label>
                                <input type="text" id="animal_poblacion" name="poblacion" 
                                       class="form-input w-full px-4 py-3 rounded-lg" required 
                                       placeholder="Ciudad">
                            </div>
                            
                            <div>
                                <label for="animal_provincia" class="block text-sm font-medium form-label mb-2">
                                    Provincia <span class="text-red-400">*</span>
                                </label>
                                <input type="text" id="animal_provincia" name="provincia" 
                                       class="form-input w-full px-4 py-3 rounded-lg" required 
                                       placeholder="Provincia">
                            </div>
                            
                            <div>
                                <label for="animal_codigo_postal" class="block text-sm font-medium form-label mb-2">
                                    Código Postal <span class="text-red-400">*</span>
                                </label>
                                <input type="text" id="animal_codigo_postal" name="codigo_postal" 
                                       class="form-input w-full px-4 py-3 rounded-lg" required 
                                       placeholder="12345">
                            </div>
                        </div>
                    </div>

                    <!-- Descripción -->
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4 border-b border-gray-600 pb-2">Descripción</h3>
                        <div>
                            <label for="animal_descripcion" class="block text-sm font-medium form-label mb-2">
                                Descripción <span class="text-red-400">*</span>
                            </label>
                            <textarea id="animal_descripcion" name="descripcion" rows="4"
                                      class="form-input w-full px-4 py-3 rounded-lg resize-none" required 
                                      placeholder="Cuéntanos sobre este animal especial..."></textarea>
                            <p class="text-gray-500 text-xs mt-1">Máximo 500 caracteres</p>
                        </div>
                    </div>

                    <button type="submit" id="crearAnimalSubmitBtn" class="btn-primary w-full px-6 py-4 rounded-lg font-semibold text-white text-lg">
                        <span class="button-text">Crear Animal</span>
                        <span class="button-loading hidden flex items-center justify-center">
                            <div class="create-spinner-small mr-2"></div>
                            <span class="loading-dots">Procesando</span>
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Navbar -->
<nav class="navbar-glass fixed top-0 left-0 w-full flex items-center justify-between px-6 py-4 z-40">
    <div class="text-left">
        <h1 class="text-xl font-bold text-white">Adopta</h1>
        {% if request.session.esta_logueado %}
            <p class="text-sm text-gray-400">Hola, {{ request.session.asociacion_nombre }}</p>
        {% endif %}
    </div>

    <div class="flex items-center gap-4">
        <!-- Nuevo botón de Buscador Avanzado -->
        <a href="/buscador-avanzado/" class="btn-secondary px-4 py-2 rounded-lg text-sm font-medium text-white flex items-center">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            Búsqueda Avanzada
        </a>
        
        <a href="/mis-favoritos/" class="btn-secondary px-4 py-2 rounded-lg text-sm font-medium text-white flex items-center">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
            Favoritos
            <span id="favoritesCounter" class="favorites-counter hidden">0</span>
        </a>
        
        {% if request.session.esta_logueado %}
            <a href="/mis_animales/" class="btn-secondary px-4 py-2 rounded-lg text-sm font-medium text-white">
                Mis Animales
            </a>
            <button onclick="abrirCrearAnimal()" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium text-white">
                Crear Animal
            </button>
            <a href="/logout/" class="text-red-400 hover:text-red-300 px-4 py-2 border border-red-400/30 hover:border-red-300 rounded-lg text-sm transition-all duration-300">
                Salir
            </a>
        {% else %}
            <button onclick="abrirLogin()" class="btn-primary px-6 py-2 rounded-lg text-sm font-medium text-white">
                Iniciar sesión
            </button>
        {% endif %}
    </div>
</nav>
    <!-- Contenido principal -->
    <div class="max-w-7xl mx-auto px-6 py-20">
        
        <!-- Título y descripción principal -->
        <div class="text-center mb-16 fade-in">
            <h1 class="main-title">
                Encuentra tu compañero perfecto
            </h1>
            <p class="text-xl text-gray-400 max-w-2xl mx-auto leading-relaxed">
                Conectamos corazones. Cada animal merece una segunda oportunidad y un hogar lleno de amor.
            </p>
        </div>

        <!-- Filtros y buscador -->
        <div class="mb-12 fade-in">
            <!-- Filtros -->
            <div class="filter-container rounded-2xl p-6 mb-8">
                <div class="flex flex-wrap justify-center gap-3 mb-6">
                    <button onclick="filtrarPorTipo('')" 
                            class="filter-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-300 active" 
                            id="btn-todos">
                        Todos
                    </button>
                    <button onclick="filtrarPorTipo('perro')" 
                            class="filter-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-300" 
                            id="btn-perro">
                        Perros
                    </button>
                    <button onclick="filtrarPorTipo('gato')" 
                            class="filter-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-300" 
                            id="btn-gato">
                        Gatos
                    </button>
                    <button onclick="filtrarPorTipo('conejo')" 
                            class="filter-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-300" 
                            id="btn-conejo">
                        Conejos
                    </button>
                    <button onclick="filtrarPorTipo('pájaro')" 
                            class="filter-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-300" 
                            id="btn-pájaro">
                        Pájaros
                    </button>
                    <button onclick="filtrarPorTipo('otros')" 
                            class="filter-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-300" 
                            id="btn-otros">
                        Otros
                    </button>
                </div>
                
                <!-- Buscador -->
                <div class="max-w-md mx-auto">
                    <input 
                        type="text" 
                        id="buscadorAnimales" 
                        placeholder="Buscar por nombre, raza o provincia..." 
                        class="search-input w-full px-4 py-3 rounded-xl transition-all duration-300"
                    >
                </div>
            </div>

            <!-- Contador de resultados -->
            <div class="text-center mb-8">
                <span id="contadorResultados" class="results-counter inline-block px-4 py-2 rounded-full text-sm font-medium"></span>
            </div>
        </div>

        <!-- Grid de animales -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="contenedorAnimales">
            <!-- Las tarjetas se generan dinámicamente -->
        </div>
    </div>

</div>

<!-- JavaScript -->
<script>
    // Datos de animales
    let animalesData = [
        {% for animal in animales %}
        {
            id: {{ animal.id }},
            nombre: "{{ animal.nombre|escapejs }}",
            tipo: "{{ animal.tipo_de_animal|escapejs }}",
            raza: "{{ animal.raza|escapejs }}",
            color: "{{ animal.color|escapejs }}",
            email: "{{ animal.email|escapejs }}",
            telefono: "{{ animal.telefono|escapejs }}",
            poblacion: "{{ animal.poblacion|escapejs }}",
            provincia: "{{ animal.provincia|escapejs }}",
            descripcion: "{{ animal.descripcion|escapejs }}",
            imagen: "{% if animal.imagen %}{{ animal.imagen.url }}{% endif %}"
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];

    let filtroActual = '';
    let favoritos = JSON.parse(localStorage.getItem('favoritos')) || [];

    // Función para manejar cambios en el selector de color
    function manejarCambioColor() {
        const colorSelect = document.getElementById('animal_color_select');
        const colorCustom = document.getElementById('animal_color_custom');
        const colorFinal = document.getElementById('animal_color_final');
        
        if (colorSelect.value === 'Otro') {
            colorCustom.classList.remove('hidden');
            colorCustom.setAttribute('required', 'required');
            colorCustom.focus();
            colorFinal.value = '';
            
            colorCustom.addEventListener('input', function() {
                colorFinal.value = this.value.trim();
            });
            
        } else if (colorSelect.value === '') {
            colorCustom.classList.add('hidden');
            colorCustom.removeAttribute('required');
            colorCustom.value = '';
            colorFinal.value = '';
            
        } else {
            colorCustom.classList.add('hidden');
            colorCustom.removeAttribute('required');
            colorCustom.value = '';
            colorFinal.value = colorSelect.value;
        }
    }

    // Función para resetear el selector de color
    function resetColorSelector() {
        const colorSelect = document.getElementById('animal_color_select');
        const colorCustom = document.getElementById('animal_color_custom');
        const colorFinal = document.getElementById('animal_color_final');
        
        if (colorSelect) colorSelect.value = '';
        if (colorCustom) {
            colorCustom.classList.add('hidden');
            colorCustom.removeAttribute('required');
            colorCustom.value = '';
        }
        if (colorFinal) colorFinal.value = '';
    }

    // Validación del formulario antes del envío
    function validarColorAntesDelEnvio() {
        const colorSelect = document.getElementById('animal_color_select');
        const colorCustom = document.getElementById('animal_color_custom');
        const colorFinal = document.getElementById('animal_color_final');
        
        if (colorSelect.value === '') {
            alert('Por favor, selecciona un color para el animal.');
            colorSelect.focus();
            return false;
        }
        
        if (colorSelect.value === 'Otro' && (!colorCustom.value || colorCustom.value.trim() === '')) {
            alert('Por favor, especifica el color del animal.');
            colorCustom.focus();
            return false;
        }
        
        if (!colorFinal.value || colorFinal.value.trim() === '') {
            manejarCambioColor();
            if (!colorFinal.value || colorFinal.value.trim() === '') {
                alert('Error al procesar el color. Por favor, intenta de nuevo.');
                return false;
            }
        }
        
        return true;
    }

    // Crear fondo de estrellas
    function crearEstrellas() {
        const starfield = document.getElementById('starfield');
        const numStars = 150;
        
        for (let i = 0; i < numStars; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            
            if (Math.random() < 0.1) star.classList.add('large');
            if (Math.random() < 0.05) star.classList.add('bright');
            
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            
            starfield.appendChild(star);
        }
        
        setInterval(() => {
            if (Math.random() < 0.3) {
                const shootingStar = document.createElement('div');
                shootingStar.className = 'shooting-star';
                shootingStar.style.left = Math.random() * 100 + '%';
                shootingStar.style.top = Math.random() * 100 + '%';
                
                starfield.appendChild(shootingStar);
                
                setTimeout(() => {
                    if (shootingStar.parentNode) {
                        shootingStar.remove();
                    }
                }, 2000);
            }
        }, 3000);
    }

    // Crear placeholder de carga
    function crearPlaceholder(index) {
        return `
            <div class="loading-card rounded-2xl p-6 h-auto" data-index="${index}">
                <div class="loading-shimmer aspect-square rounded-xl mb-4"></div>
                <div class="loading-shimmer rounded h-6 mb-2"></div>
                <div class="loading-shimmer rounded h-4 w-3/4 mb-2"></div>
                <div class="loading-shimmer rounded h-4 w-1/2"></div>
            </div>
        `;
    }

    // Crear tarjeta de animal
    function crearTarjetaAnimal(animal) {
        const esFavorito = favoritos.includes(animal.id);
        
        return `
            <div class="animal-card rounded-2xl overflow-hidden fade-in" 
                 data-nombre="${animal.nombre.toLowerCase()}" 
                 data-tipo="${animal.tipo.toLowerCase()}"
                 data-raza="${animal.raza.toLowerCase()}"
                 data-provincia="${animal.provincia.toLowerCase()}"
                 data-id="${animal.id}">
                
                <!-- Botón de favorito -->
                <button onclick="toggleFavorito(${animal.id}, this, event)" 
                        class="favorite-btn ${esFavorito ? 'active' : ''}" 
                        data-favorito="${esFavorito}">
                    ${esFavorito ? `
                        <svg class="heart-icon heart-filled" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                    ` : `
                        <svg class="heart-icon heart-outline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                    `}
                </button>
                
                <a href="/ver_animal/${animal.id}/" class="block">
                    <div class="card-content">
                        <div class="aspect-square bg-gray-800 rounded-t-2xl overflow-hidden relative">
                            ${animal.imagen ? `
                                <img src="${animal.imagen}" 
                                     alt="${animal.nombre}" 
                                     class="w-full h-full object-cover object-center transition-transform duration-500 hover:scale-110">
                            ` : `
                                <div class="w-full h-full flex items-center justify-center text-gray-500">
                                    <svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                            `}
                        </div>
                        
                        <div class="p-6 text-center">
                            <h3 class="text-2xl font-bold text-white mb-1 tracking-wide">${animal.nombre}</h3>
                            <p class="text-blue-300 font-medium text-sm uppercase tracking-wider mb-3 opacity-90">${animal.raza}</p>
                            
                            <div class="flex items-center justify-center text-gray-400 text-sm">
                                <svg class="w-4 h-4 mr-1.5 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span class="font-medium">${animal.poblacion}, ${animal.provincia}</span>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        `;
    }

    // Toggle favorito
    function toggleFavorito(animalId, button, event) {
        event.preventDefault();
        event.stopPropagation();
        
        const esFavorito = favoritos.includes(animalId);
        
        if (esFavorito) {
            // Quitar de favoritos
            favoritos = favoritos.filter(id => id !== animalId);
            button.classList.remove('active');
            button.innerHTML = `
                <svg class="heart-icon heart-outline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
            `;
        } else {
            // Agregar a favoritos
            favoritos.push(animalId);
            button.classList.add('active');
            button.innerHTML = `
                <svg class="heart-icon heart-filled" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
            `;
            
            // Animación
            button.classList.add('animate-heart');
            setTimeout(() => button.classList.remove('animate-heart'), 600);
        }
        
        // Guardar en localStorage
        localStorage.setItem('favoritos', JSON.stringify(favoritos));
        
        // Actualizar contador
        actualizarContadorFavoritos();
    }

    // Actualizar contador de favoritos
    function actualizarContadorFavoritos() {
        const counter = document.getElementById('favoritesCounter');
        
        if (favoritos.length > 0) {
            counter.textContent = favoritos.length;
            counter.classList.remove('hidden');
        } else {
            counter.classList.add('hidden');
        }
    }

    // Intersection Observer para cargar tarjetas
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const placeholder = entry.target;
                const index = parseInt(placeholder.dataset.index);
                const animal = animalesData[index];
                
                if (animal) {
                    placeholder.outerHTML = crearTarjetaAnimal(animal);
                }
                
                observer.unobserve(placeholder);
            }
        });
    }, { rootMargin: '100px' });

    // Inicializar placeholders
    function inicializarAnimales() {
        const contenedor = document.getElementById('contenedorAnimales');
        contenedor.innerHTML = '';
        
        animalesData.forEach((animal, index) => {
            contenedor.innerHTML += crearPlaceholder(index);
        });
        
        setTimeout(() => {
            document.querySelectorAll('.loading-card').forEach(card => {
                observer.observe(card);
            });
        }, 100);
    }

    // Normalizar texto para búsqueda
    function normalizarTexto(texto) {
        return texto.toLowerCase()
                   .normalize('NFD')
                   .replace(/[\u0300-\u036f]/g, '')
                   .trim();
    }

    // Filtrar por tipo
    function filtrarPorTipo(tipo) {
        filtroActual = tipo;
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        if (tipo === '') {
            document.getElementById('btn-todos').classList.add('active');
        } else {
            document.getElementById('btn-' + tipo).classList.add('active');
        }
        
        aplicarFiltros();
    }

    // Aplicar filtros
    function aplicarFiltros() {
        const busqueda = normalizarTexto(document.getElementById('buscadorAnimales').value);
        const tarjetas = document.querySelectorAll('.animal-card');
        let contador = 0;
        
        tarjetas.forEach(tarjeta => {
            const nombre = normalizarTexto(tarjeta.dataset.nombre);
            const tipo = normalizarTexto(tarjeta.dataset.tipo);
            const raza = normalizarTexto(tarjeta.dataset.raza);
            const provincia = normalizarTexto(tarjeta.dataset.provincia);
            
            const cumpleBusqueda = !busqueda || 
                nombre.includes(busqueda) || 
                tipo.includes(busqueda) || 
                raza.includes(busqueda) || 
                provincia.includes(busqueda);
            
            let cumpleTipo = true;
            if (filtroActual !== '') {
                if (filtroActual === 'otros') {
                    cumpleTipo = !tipo.includes('perro') && 
                                !tipo.includes('gato') && 
                                !tipo.includes('conejo') && 
                                !tipo.includes('pájaro');
                } else {
                    cumpleTipo = tipo.includes(filtroActual);
                }
            }
            
            if (cumpleBusqueda && cumpleTipo) {
                tarjeta.style.display = 'block';
                contador++;
            } else {
                tarjeta.style.display = 'none';
            }
        });
        
        actualizarContador(contador);
    }

    // Actualizar contador
    function actualizarContador(cantidad) {
        const contador = document.getElementById('contadorResultados');
        
        if (cantidad === 0) {
            contador.textContent = 'No se encontraron animales';
            contador.className = 'results-counter no-results inline-block px-4 py-2 rounded-full text-sm font-medium';
        } else {
            contador.textContent = `${cantidad} animal${cantidad !== 1 ? 'es' : ''} disponible${cantidad !== 1 ? 's' : ''}`;
            contador.className = 'results-counter inline-block px-4 py-2 rounded-full text-sm font-medium';
        }
    }

    // Modal de crear animal
    function abrirCrearAnimal() {
        const modal = document.getElementById('crearAnimalModal');
        const content = document.getElementById('crearAnimalContent');
        
        modal.classList.remove('hidden');
        setTimeout(() => {
            content.classList.remove('scale-95', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');
        }, 10);
    }

    function cerrarCrearAnimal() {
        const modal = document.getElementById('crearAnimalModal');
        const content = document.getElementById('crearAnimalContent');
        
        content.classList.remove('scale-100', 'opacity-100');
        content.classList.add('scale-95', 'opacity-0');
        
        setTimeout(() => {
            modal.classList.add('hidden');
            resetCrearAnimalForm();
        }, 500);
    }

    // Reset del formulario de crear animal
    function resetCrearAnimalForm() {
        const form = document.getElementById('crearAnimalFormElement');
        if (form) form.reset();
        
        setCrearAnimalButtonLoading(false);
        showCrearAnimalOverlay(false);
        
        quitarImagen();
        quitarVideo();
        resetColorSelector(); // Agregado para resetear el selector de color
    }

    // Loading states
    function setCrearAnimalButtonLoading(loading = true) {
        const button = document.getElementById('crearAnimalSubmitBtn');
        if (!button) return;
        
        const textSpan = button.querySelector('.button-text');
        const loadingSpan = button.querySelector('.button-loading');
        
        if (loading) {
            if (textSpan) textSpan.classList.add('hidden');
            if (loadingSpan) loadingSpan.classList.remove('hidden');
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');
        } else {
            if (textSpan) textSpan.classList.remove('hidden');
            if (loadingSpan) loadingSpan.classList.add('hidden');
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');
        }
    }

    function showCrearAnimalOverlay(show = true) {
        const overlay = document.getElementById('crearAnimalLoadingOverlay');
        if (overlay) {
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }
    }

    // Indicadores de archivos con opción de quitar
    function initFileIndicators() {
        const imagenInput = document.getElementById('animal_imagen');
        const videoInput = document.getElementById('animal_video');

        if (imagenInput) {
            imagenInput.addEventListener('change', function(e) {
                const statusDiv = document.getElementById('imagenStatus');
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const fileName = file.name;
                    const fileSize = (file.size / (1024 * 1024)).toFixed(2);
                    
                    if (statusDiv) {
                        statusDiv.innerHTML = `
                            <div class="file-indicator flex items-center justify-between">
                                <div>
                                    <span class="text-green-400">✓ Imagen: ${fileName}</span>
                                    <span class="text-xs text-gray-400 block">${fileSize} MB</span>
                                </div>
                                <button type="button" onclick="quitarImagen()" 
                                        class="ml-3 text-red-400 hover:text-red-300 transition-colors duration-200 text-sm font-medium flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Quitar
                                </button>
                            </div>
                        `;
                        statusDiv.classList.remove('hidden');
                    }
                } else {
                    if (statusDiv) {
                        statusDiv.classList.add('hidden');
                        statusDiv.innerHTML = '';
                    }
                }
            });
        }

        if (videoInput) {
            videoInput.addEventListener('change', function(e) {
                const statusDiv = document.getElementById('videoStatus');
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const fileName = file.name;
                    const fileSize = (file.size / (1024 * 1024)).toFixed(2);
                    
                    if (statusDiv) {
                        statusDiv.innerHTML = `
                            <div class="file-indicator flex items-center justify-between">
                                <div>
                                    <span class="text-green-400">✓ Video: ${fileName}</span>
                                    <span class="text-xs text-gray-400 block">${fileSize} MB</span>
                                </div>
                                <button type="button" onclick="quitarVideo()" 
                                        class="ml-3 text-red-400 hover:text-red-300 transition-colors duration-200 text-sm font-medium flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Quitar
                                </button>
                            </div>
                        `;
                        statusDiv.classList.remove('hidden');
                    }
                } else {
                    if (statusDiv) {
                        statusDiv.classList.add('hidden');
                        statusDiv.innerHTML = '';
                    }
                }
            });
        }

        // Agregar validación al formulario de crear animal
        const crearAnimalForm = document.getElementById('crearAnimalFormElement');
        if (crearAnimalForm) {
            crearAnimalForm.addEventListener('submit', function(e) {
                if (!validarColorAntesDelEnvio()) {
                    e.preventDefault();
                    return false;
                }
                setCrearAnimalButtonLoading(true);
                showCrearAnimalOverlay(true);
            });
        }
    }

    // Funciones para quitar archivos
    function quitarImagen() {
        const imagenInput = document.getElementById('animal_imagen');
        const statusDiv = document.getElementById('imagenStatus');
        
        if (imagenInput) {
            imagenInput.value = '';
        }
        
        if (statusDiv) {
            statusDiv.classList.add('hidden');
            statusDiv.innerHTML = '';
        }
    }

    function quitarVideo() {
        const videoInput = document.getElementById('animal_video');
        const statusDiv = document.getElementById('videoStatus');
        
        if (videoInput) {
            videoInput.value = '';
        }
        
        if (statusDiv) {
            statusDiv.classList.add('hidden');
            statusDiv.innerHTML = '';
        }
    }

    function abrirLogin() {
        const modal = document.getElementById('authModal');
        const content = document.getElementById('modalContent');
        
        mostrarLogin();
        
        modal.classList.remove('hidden');
        setTimeout(() => {
            content.classList.remove('scale-95', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');
        }, 10);
    }

    function cerrarModal() {
        const modal = document.getElementById('authModal');
        const content = document.getElementById('modalContent');
        
        content.classList.remove('scale-100', 'opacity-100');
        content.classList.add('scale-95', 'opacity-0');
        
        setTimeout(() => {
            modal.classList.add('hidden');
            resetForms();
        }, 500);
    }

    function mostrarLogin() {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        
        registerForm.style.opacity = '0';
        setTimeout(() => {
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            setTimeout(() => {
                loginForm.style.opacity = '1';
            }, 10);
        }, 150);
    }

    function mostrarRegistro() {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        
        loginForm.style.opacity = '0';
        setTimeout(() => {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            setTimeout(() => {
                registerForm.style.opacity = '1';
            }, 10);
        }, 150);
    }

    function resetForms() {
        const loginForm = document.querySelector('#loginForm form');
        const registerForm = document.getElementById('registerFormElement');
        
        if (loginForm) loginForm.reset();
        if (registerForm) registerForm.reset();
        
        setRegisterButtonLoading(false);
        showRegisterOverlay(false);
        
        const logoStatus = document.getElementById('logoStatus');
        if (logoStatus) logoStatus.classList.add('hidden');
    }

    function setRegisterButtonLoading(loading = true) {
        const button = document.getElementById('registerSubmitBtn');
        if (!button) return;
        
        const textSpan = button.querySelector('.button-text');
        const loadingSpan = button.querySelector('.button-loading');
        
        if (loading) {
            if (textSpan) textSpan.classList.add('hidden');
            if (loadingSpan) loadingSpan.classList.remove('hidden');
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');
        } else {
            if (textSpan) textSpan.classList.remove('hidden');
            if (loadingSpan) loadingSpan.classList.add('hidden');
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');
        }
    }

    function showRegisterOverlay(show = true) {
        const overlay = document.getElementById('registerLoadingOverlay');
        if (overlay) {
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }
    }

    function initModalForms() {
        const registerForm = document.getElementById('registerFormElement');
        const logoInput = document.getElementById('reg_logo');

        if (registerForm) {
            registerForm.addEventListener('submit', function(e) {
                setRegisterButtonLoading(true);
                showRegisterOverlay(true);
            });
        }

        if (logoInput) {
            logoInput.addEventListener('change', function(e) {
                const statusDiv = document.getElementById('logoStatus');
                if (e.target.files.length > 0) {
                    const fileName = e.target.files[0].name;
                    if (statusDiv) {
                        statusDiv.innerHTML = `<span class="text-green-400">✓ ${fileName} seleccionado</span>`;
                        statusDiv.classList.remove('hidden');
                    }
                } else {
                    if (statusDiv) {
                        statusDiv.classList.add('hidden');
                    }
                }
            });
        }

        const loginForm = document.getElementById('loginForm');
        const registerFormDiv = document.getElementById('registerForm');
        
        if (loginForm) loginForm.style.opacity = '1';
        if (registerFormDiv) registerFormDiv.style.opacity = '1';
    }

    // Event listeners
    document.getElementById('buscadorAnimales').addEventListener('input', aplicarFiltros);
    
    document.getElementById('authModal').addEventListener('click', function(e) {
        if (e.target === this) cerrarModal();
    });

    document.getElementById('crearAnimalModal').addEventListener('click', function(e) {
        if (e.target === this) cerrarCrearAnimal();
    });

    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
        crearEstrellas();
        inicializarAnimales();
        actualizarContador(animalesData.length);
        actualizarContadorFavoritos();
        
        setTimeout(() => {
            document.querySelectorAll('.fade-in').forEach((el, i) => {
                setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, i * 100);
            });
        }, 200);

        initModalForms();
        initFileIndicators();
    });

    // Efecto parallax
    let ticking = false;
    
    window.addEventListener('scroll', () => {
        if (!ticking) {
            requestAnimationFrame(() => {
                const scrolled = window.pageYOffset;
                const stars = document.querySelectorAll('.star');
                
                stars.forEach((star, i) => {
                    if (i % 3 === 0) {
                        const speed = 0.5;
                        star.style.transform = `translateY(${scrolled * speed}px)`;
                    }
                });
                
                ticking = false;
            });
            ticking = true;
        }
    });
</script>

</body>
</html>